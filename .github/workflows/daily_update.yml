name: Aktualizacja Historii FRA
on:
  schedule:
    - cron: '0 8 * * *'
    - cron: '0 15 * * *'
  workflow_dispatch:

jobs:
  update_history:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Pobieranie danych i aktualizacja JSON
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          npm install -g @google/generative-ai-cli
          
          # Pobieranie stron
          curl -s -L -A "Mozilla/5.0" https://www.patria.cz/kurzy/EUR/3x6/fra/graf.html > t3.txt
          curl -s -L -A "Mozilla/5.0" https://www.patria.cz/kurzy/EUR/6x9/fra/graf.html > t6.txt
          curl -s -L -A "Mozilla/5.0" https://www.patria.cz/kurzy/EUR/9x12/fra/graf.html > t9.txt
          
          # Gemini bierze plik data.json oraz nowe dane i tworzy nową wersję JSONa
          # Prosimy AI, aby dopisało nowe rekordy do istniejącej listy
          cat data.json t3.txt t6.txt t9.txt | gemini "W pliku data.json masz historię kursów w formacie JSON (lista obiektów). Z pozostałych tekstów wyciągnij aktualne wartości Aktuální hodnota dla 3x6, 6x9 i 9x12. Dodaj nowy obiekt do listy z dzisiejszą datą i tymi wartościami. Zwróć TYLKO czysty kod JSON (całą zaktualizowaną listę)." > data.json.tmp
          
          mv data.json.tmp data.json

      - name: Zapisanie zmian
        run: |
          git config --global user.name "FRA-Bot"
          git config --global user.email "bot@github.com"
          git add data.json
          git commit -m "Nowy wpis w historii: $(date)" || exit 0
          git push
