name: Pobieranie Kursów FRA
on:
  schedule:
    # Uruchamia się o 8:00 i 15:00 czasu UTC (co odpowiada 9:00 i 16:00 w Polsce)
    - cron: '0 8 * * *'
    - cron: '0 15 * * *'
  workflow_dispatch: # Pozwala Ci uruchomić to ręcznie przyciskiem "Run workflow"

jobs:
  update_rates:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Instalacja Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Pobieranie danych i analiza Gemini
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          npm install -g @google/generative-ai-cli
          
          # Pobieranie 3 stron udając przeglądarkę
          curl -s -L -A "Mozilla/5.0" https://www.patria.cz/kurzy/EUR/3x6/fra/graf.html > t3.txt
          curl -s -L -A "Mozilla/5.0" https://www.patria.cz/kurzy/EUR/6x9/fra/graf.html > t6.txt
          curl -s -L -A "Mozilla/5.0" https://www.patria.cz/kurzy/EUR/9x12/fra/graf.html > t9.txt
          
          # Gemini tworzy plik index.html na podstawie pobranych danych
          cat t3.txt t6.txt t9.txt | gemini "Z dostarczonego kodu HTML wyciągnij wartości Aktuální hodnota dla trzech okresów: 3x6, 6x9 oraz 9x12. Stwórz z nich bardzo ładną, nowoczesną stronę HTML z tabelą. Użyj ciemnego motywu (dark mode), czcionki Sans-Serif i dodaj informację o dacie ostatniej aktualizacji: $(date). Odpoweidź TYLKO kodem HTML." > index.html

      - name: Zapisanie zmian w repozytorium
        run: |
          git config --global user.name "FRA-Bot"
          git config --global user.email "bot@github.com"
          git add index.html
          git commit -m "Aktualizacja kursów FRA: $(date)" || exit 0
          git push
